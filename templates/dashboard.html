{% extends "base.html" %}
{% block banner %}
<div class="page-header-banner">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">Ã‰vÃ©nements</h3>
            <div class="d-flex gap-2">
                <form action="{{ url_for('admin.dashboard') }}" method="GET" class="d-flex align-items-center">
                    <select name="filter" class="form-select me-2" onchange="this.form.submit()">
                        <option value="all" {% if current_filter=='all' %}selected{% endif %}>Tous les Ã‰vÃ©nements
                        </option>
                        <option value="mine" {% if current_filter=='mine' %}selected{% endif %}>Mes Ã‰vÃ©nements</option>
                        <option value="future" {% if current_filter=='future' %}selected{% endif %}>Ã‰vÃ©nements Ã  venir
                        </option>
                        <option value="past" {% if current_filter=='past' %}selected{% endif %}>Ã‰vÃ©nements passÃ©s
                        </option>
                    </select>
                </form>
                <a href="{{ url_for('event.create_event') }}" class="btn btn-primary" data-bs-toggle="tooltip"
                    title="Ajouter un Ã©vÃ©nement">CrÃ©er</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}

<div class="d-flex flex-column gap-2">
    {% for e in events %}
    {% set participation = my_roles.get(e.id) %}
    {% set row_class = "" %}
    {% set badge_class = "" %}
    {% set badge_text = "" %}

    {% if participation %}
    {% if participation.registration_status == 'En attente' or participation.registration_status == 'Ã€ valider' %}
    {% set row_class = "list-group-item-secondary" %}
    {% set badge_class = "bg-light text-dark border" %}
    {% set badge_text = participation.type ~ " (En Attente)" %}
    {% elif participation.is_organizer %}
    {% set row_class = "list-group-item-danger" %}
    {% set badge_class = "bg-danger" %}
    {% set badge_text = "Organisateur" %}
    {% elif participation.is_pj %}
    {% set row_class = "list-group-item-success" %}
    {% set badge_class = "bg-success" %}
    {% set badge_text = "PJ" %}
    {% elif participation.is_pnj %}
    {% set row_class = "list-group-item-primary" %}
    {% set badge_class = "bg-primary" %}
    {% set badge_text = "PNJ" %}
    {% else %}
    {% set row_class = "list-group-item-success" %}
    {% set badge_class = "bg-success" %}
    {% set badge_text = participation.type %}
    {% endif %}
    {% endif %}

    {% set status_color = "bg-secondary" %}
    {% if e.statut == "Ã‰vÃ©nement en cours" %}
    {% set status_color = "bg-success" %}
    {% elif e.statut == "TerminÃ©" %}
    {% set status_color = "bg-dark" %}
    {% elif e.statut == "AnnulÃ©" %}
    {% set status_color = "bg-danger" %}
    {% elif e.statut == "En prÃ©paration" %}
    {% set status_color = "bg-info text-dark" %}
    {% elif e.statut == "Inscriptions ouvertes" %}
    {% set status_color = "bg-success" %}
    {% endif %}

    <a href="{{ url_for('event.detail', event_id=e.id) }}"
        class="list-group-item list-group-item-action border rounded shadow-sm p-3 {{ row_class }}">
        <div class="d-flex w-100 justify-content-between align-items-center">
            <h5 class="mb-1">
                {{ e.name }}
                <span class="badge {{ status_color }}">{{ e.statut }}</span>
                {% if participation %}
                <span class="badge {{ badge_class }} ms-2">{{ badge_text }}
                    {% if (participation.registration_status != 'En attente' and participation.registration_status != 'Ã€
                    valider') and participation.group and participation.group != 'Peu importe' %}
                    - {{ participation.group }}
                    {% endif %}
                </span>
                {% endif %}
            </h5>
            <small class="text-muted">
                <i class="bi bi-calendar-range me-1"></i>
                Du {{ e.date_start.strftime('%d/%m/%Y') }} au {{ e.date_end.strftime('%d/%m/%Y') }}
            </small>
        </div>
        <div class="mt-2 text-muted small">
            Par :
            <span class="association-medallion">
                {{ e.organizing_association or 'une entitÃ© mystÃ©rieuse et inquiÃ©tante' }}
            </span>
            Ã  {{ e.location }}
        </div>
    </a>
    {% else %}
    <p class="text-muted text-center mt-4">Aucun Ã©vÃ©nement trouvÃ© pour ce filtre.</p>
    {% endfor %}
</div>

{% if events|length < 3 %} <div class="mt-5 pt-5 pb-5">
    <div class="d-flex flex-wrap justify-content-center gap-5 position-relative"
        style="overflow: hidden; padding: 50px;">
        <h2>Ils parlent de GNÃ´le...</h2>

        <!-- Tim Cook -->
        <div class="card p-3 shadow text-dark"
            style="max-width: 300px; transform: rotate(17deg); background-color: #fdfbf7; border: 1px solid #ddd; font-family: 'Times New Roman', serif;">
            <div class="card-body">
                <h5 class="card-title fw-bold">ğŸ Tim Cook (Apple)</h5>
                <p class="card-text fst-italic">Â« Câ€™est une rÃ©volution. Nous avons rÃ©inventÃ© le bouton "Sâ€™inscrire". Il
                    est si beau que vous aurez envie de cliquer dessus juste pour le plaisir de voir le curseur bouger.
                    Câ€™est lâ€™expÃ©rience dâ€™inscription la plus magique et la plus pro-vie privÃ©e que nous ayons jamais
                    ignorÃ©e pour crÃ©er la nÃ´tre dans deux ans. Câ€™est "Inscrire" avec un grand I. Â»</p>
            </div>
        </div>

        <!-- Elon Musk -->
        <div class="card p-3 shadow text-dark"
            style="max-width: 300px; transform: rotate(-22deg); background-color: #fdfbf7; border: 1px solid #ddd; font-family: 'Times New Roman', serif;">
            <div class="card-body">
                <h5 class="card-title fw-bold">ğŸš€ Elon Musk (X / Tesla / SpaceX)</h5>
                <p class="card-text fst-italic">Â« Pas mal. Mais est-ce que ce logiciel peut gÃ©rer 14 millions
                    d'inscriptions simultanÃ©es pour le premier festival de techno sur Mars ? Si la rÃ©ponse est non,
                    câ€™est du code de "low energy". Sâ€™il y a un mode "LUDICROUS" pour remplir la salle en 3 secondes, je
                    rachÃ¨te la boÃ®te et je change le nom pour "Z". Â»</p>
            </div>
        </div>

        <!-- Mark Zuckerberg -->
        <div class="card p-3 shadow text-dark"
            style="max-width: 300px; transform: rotate(28deg); background-color: #fdfbf7; border: 1px solid #ddd; font-family: 'Times New Roman', serif;">
            <div class="card-body">
                <h5 class="card-title fw-bold">ğŸ‘“ Mark Zuckerberg (Meta)</h5>
                <p class="card-text fst-italic">Â« Jâ€™adore ce logiciel. Il me permet de savoir exactement qui vient Ã  la
                    soirÃ©e, ce quâ€™ils mangent, et sâ€™ils sont tristes ou contents d'Ãªtre lÃ , avant mÃªme qu'ils ne passent
                    la porte. On se voit dans le mÃ©tavers pour le check-in ? J'ai un nouvel avatar avec des jambes
                    exprÃ¨s pour l'occasion. Â»</p>
            </div>
        </div>

        <!-- Bill Gates -->
        <div class="card p-3 shadow text-dark"
            style="max-width: 300px; transform: rotate(-15deg); background-color: #fdfbf7; border: 1px solid #ddd; font-family: 'Times New Roman', serif;">
            <div class="card-body">
                <h5 class="card-title fw-bold">ğŸ’» Bill Gates (Microsoft)</h5>
                <p class="card-text fst-italic">Â« Câ€™est fantastique. Jâ€™ai particuliÃ¨rement apprÃ©ciÃ© la faÃ§on dont le
                    formulaire dâ€™inscription sâ€™intÃ¨gre parfaitement Ã  Excel. Rien ne me procure plus de sÃ©rotonine
                    quâ€™une liste dâ€™invitÃ©s triÃ©e par ordre alphabÃ©tique dans un tableau croisÃ© dynamique. Câ€™est...
                    excitant. Â»</p>
            </div>
        </div>

        <!-- Jeff Bezos -->
        <div class="card p-3 shadow text-dark"
            style="max-width: 300px; transform: rotate(19deg); background-color: #fdfbf7; border: 1px solid #ddd; font-family: 'Times New Roman', serif;">
            <div class="card-body">
                <h5 class="card-title fw-bold">ğŸ“¦ Jeff Bezos (Amazon)</h5>
                <p class="card-text fst-italic">Â« Le bouton "S'inscrire en 1-Click" est une Å“uvre d'art. J'ai testÃ© le
                    logiciel : j'ai voulu m'inscrire au GN cyberpunk "Devenir le Maitre de vos donnÃ©es", et avant mÃªme
                    d'avoir fini de taper mon
                    nom, un drone livrait dÃ©jÃ  mon NERF customisÃ© dans mon jardin. Efficiency is everything. Â»
                </p>
            </div>
        </div>

        <!-- Donald Trump -->
        <div class="card p-3 shadow text-dark"
            style="max-width: 300px; transform: rotate(-5deg); background-color: #fdfbf7; border: 1px solid #ddd; font-family: 'Times New Roman', serif;">
            <div class="card-body">
                <h5 class="card-title fw-bold">Donald Trump (USA)</h5>
                <p class="card-text fst-italic">Â« What ?! We can't buy it ?! Prepare invasion !!! Â»
                </p>
            </div>
        </div>
    </div>
    </div>
    {% endif %}

    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    {% endblock %}

    {% block scripts %}
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    {% endblock %}