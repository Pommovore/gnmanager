{% extends "base.html" %}
{% block content %}
<h3>Mon Profil
    {% if user.role == 'createur' %}
    <span class="badge bg-dark fs-6 align-middle ms-1">Créateur</span>
    {% elif user.role == 'sysadmin' %}
    <span class="badge bg-warning text-dark fs-6 align-middle ms-1">SysAdmin</span>
    {% else %}
    <span class="badge bg-success fs-6 align-middle ms-1">Actif</span>
    {% endif %}
</h3>
<form method="POST" action="{{ url_for('admin.update_profile') }}" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <div class="mb-3">
        <label class="form-label">Avatar (max 80x80)</label>
        <input type="file" class="form-control" name="avatar">
        {% if user.avatar_url %}
        <div class="mt-2">
            <img src="{{ url_for('static', filename=user.avatar_url.replace('/static/', '')) }}" alt="Avatar"
                class="img-thumbnail" style="max-width: 80px;">
        </div>
        {% endif %}
    </div>
    </div>
    <div class="mb-3">
        <label class="form-label fw-bold">Photo de Profil (max 600x800)</label>
        <div class="card p-2">
            <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" role="switch" id="is_profile_photo_public"
                    name="is_profile_photo_public" {% if user.is_profile_photo_public %}checked{% endif %}>
                <label class="form-check-label" for="is_profile_photo_public">
                    <strong>Photo publique</strong>
                    <br>
                    <small class="text-muted">Si décoché, personne d'autre que vous ne verra cette photo.</small>
                </label>
            </div>
            <input type="file" class="form-control mb-2" name="profile_photo">
            {% if user.profile_photo_url %}
            <div>
                <img src="{{ url_for('static', filename=user.profile_photo_url.replace('/static/', '')) }}"
                    alt="Photo de Profil" class="img-thumbnail" style="max-width: 200px;">
            </div>
            {% endif %}
        </div>
    </div>
    <div class="mb-3">
        <label class="form-label">Nom</label>
        <input type="text" class="form-control" name="nom" value="{{ user.nom or '' }}">
    </div>
    <div class="mb-3">
        <label class="form-label">Prénom</label>
        <input type="text" class="form-control" name="prenom" value="{{ user.prenom or '' }}">
    </div>
    <div class="mb-3">
        <label class="form-label">Age</label>
        <input type="number" class="form-control" name="age" value="{{ user.age or '' }}">
    </div>
    <div class="mb-3">
        <label class="form-label">Genre</label>
        <select class="form-select" name="genre">
            <option value="" {% if not user.genre %}selected{% endif %}>Choisir...</option>
            <option value="H" {% if user.genre=='H' %}selected{% endif %}>Homme</option>
            <option value="F" {% if user.genre=='F' %}selected{% endif %}>Femme</option>
            <option value="X" {% if user.genre=='X' %}selected{% endif %}>Indéterminé</option>
        </select>
    </div>
    <hr>
    <h4>Changer le mot de passe</h4>
    <div class="mb-3">
        <label class="form-label">Nouveau mot de passe</label>
        <input type="password" class="form-control" name="new_password">
    </div>
    <div class="mb-3">
        <label class="form-label">Confirmer le mot de passe</label>
        <input type="password" class="form-control" name="confirm_password">
    </div>
    <button type="submit" class="btn btn-primary">Mettre à jour</button>
</form>

<hr class="my-4">
<div class="text-center">
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deregisterModal">
        <i class="bi bi-person-x"></i> Se désinscrire
    </button>
</div>

<!-- Deregistration Confirmation Modal -->
<div class="modal fade" id="deregisterModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> Confirmer la désinscription</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="fw-bold">Êtes-vous sûr de vouloir vous désinscrire ?</p>
                <p>Vous serez automatiquement retiré de tous les événements auxquels vous participez.</p>

                <div class="alert alert-warning">
                    <strong><i class="bi bi-exclamation-triangle"></i> Attention :</strong>
                    Les organisateurs seront notifiés de votre désinscription.
                </div>

                <form method="POST" action="{{ url_for('admin.deregister') }}" id="deregisterForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <div class="form-check p-3 border rounded bg-light">
                        <input class="form-check-input" type="checkbox" name="delete_data" id="deleteDataCheckbox">
                        <label class="form-check-label" for="deleteDataCheckbox">
                            <strong>Supprimer toutes mes données</strong>
                            <br>
                            <small class="text-muted">
                                Si non coché, votre compte sera désactivé mais vos données seront conservées.
                            </small>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="submit" form="deregisterForm" class="btn btn-danger">
                    <i class="bi bi-person-x"></i> Confirmer la désinscription
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}